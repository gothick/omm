{% extends 'base.html.twig' %}

{% block title %}One Mile Matt Wander: {{ wander.title }}{% endblock %}
{% block stylesheets %}
{{ parent() }}
{{ include('_leaflet_stylesheets.html.twig') }}
{% endblock %}
{% block body %}
    <div class="row">
        <div class="col mx-3 headerstrip">
            <div class="row">
                <div class="col">
                    <h2>{{ wander.title }}</h2>
                </div>
            </div>
            <div class="row">
                <div class="col startendtimes">
                    {{ wander.startTime | date("D j F Y, H:i") }} to {{ wander.endTime | date("H:i") }}
                </div>
            </div>
            <div class="row">
                <div class="col">
                    <p>{{ wander.description |striptags|markdown }}</p>
                </div>
            </div>
            <div class="row minor-details py-2">
                <div class="col">
                    <p><img class="sector" src="{{ wander | sectorimgurl }}" />&nbsp;Sector: {{ wander.sector }}</p>
                </div>
            </div>
        </div>
    </div>
    {# TODO: Move this hardcoded style into the CSS. It's a 80% viewport height
       with a fallback of a hardcoded pixel value for older browsers #}
    <div id="mapid" style="height: 500px; height: 70vh;" data-mapbox-access-token="{{ mapbox_access_token }}" ></div>
    <div class="row mt-3 align-items-center gallery">
        {% for image in wander.images | sort((a, b) => a.capturedAt <=> b.capturedAt) %}
        <div class="col-lg-3 col-md-4 col-6 gallery-image-wrapper">
            {% if image.id is defined %}
            <a class="d-block mb-0 h-100" href="{{ path('image_show', {'id': image.id}) }}">
                <img
                    class="img-fluid img-thumbnail"
                    src="{{ vich_uploader_asset(image) }}"
                    title="{{ image.description }}"
                    srcset="{{ image | srcset }}"
                    sizes="(min-width: 1200px) 262.5px,
                        (min-width: 992px) 25vw,
                        (min-width: 768px) 33.3333vw,
                        50vw "
                />
            </a>
            <div class="mx-2 image-details">{{ image.title }}</div>
            <div class="mx-2 rating">{{ image.rating | star_rating }}</div>
            </p>
            {% endif %}
        </div>
        {% endfor %}
    </div>
    {% if is_granted('IS_AUTHENTICATED_REMEMBERED') %}
    <hr/>
    <div id="adminlinks">
        <a href="{{ path('admin_wanders_edit', {'id': wander.id}) }}">Wander Edit Page</a>
    </div>
    {% endif %}
{% endblock %}
{% block javascripts %}
{{ parent() }}
    {{ include('_leaflet_javascripts.html.twig') }}
    <script src="/js/map.js"></script>
    <script>
        $(function() {
            var map = setUpMap({
                scrollWheelZoom: false
            });
            addWander(map, {{ wander.id }}, true);
        });
    </script>
{% endblock %}